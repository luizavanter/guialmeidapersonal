#!/bin/bash
set -e

echo "ğŸš€ GA Personal - Setup Script"
echo "=============================="

# Check if Elixir is installed
if ! command -v elixir &> /dev/null; then
    echo "âŒ Elixir is not installed. Please install Elixir 1.15+ first."
    exit 1
fi

echo "âœ… Elixir found: $(elixir --version | grep Elixir)"

# Install dependencies
echo ""
echo "ğŸ“¦ Installing dependencies..."
mix deps.get

# Compile project
echo ""
echo "ğŸ”¨ Compiling project..."
mix compile

# Check if Docker is running
if docker info &> /dev/null; then
    echo ""
    echo "ğŸ³ Starting PostgreSQL and Redis with Docker..."
    docker-compose up -d

    # Wait for PostgreSQL to be ready
    echo "â³ Waiting for PostgreSQL to be ready..."
    sleep 5
else
    echo ""
    echo "âš ï¸  Docker is not running. Please ensure PostgreSQL is running locally."
    echo "Update config/dev.exs with your database credentials if needed."
fi

# Setup database
echo ""
echo "ğŸ—„ï¸  Setting up database..."
mix ecto.setup

echo ""
echo "âœ… Setup complete!"
echo ""
echo "ğŸ¯ Next steps:"
echo "  1. Start the server: mix phx.server"
echo "  2. API available at: http://localhost:4000"
echo ""
echo "ğŸ“ Default credentials:"
echo "  Trainer: guilherme@gapersonal.com / trainer123"
echo "  Student: maria.silva@example.com / student123"
echo ""
echo "ğŸ“š See README.md for more information"
